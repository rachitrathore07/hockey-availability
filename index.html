<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hockey Availability Dashboard</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding: 12px;
  margin: 0;
}

h2 {
  font-size: 1.3rem;
  text-align: center;
}

.card {
  background: #020617;
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 12px;
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 6px;
  border: none;
  font-size: 1rem;
}

button {
  background: #22c55e;
  color: #022c22;
  font-weight: bold;
  cursor: pointer;
}

button:active {
  transform: scale(0.98);
}

ul {
  padding-left: 18px;
}

footer {
  margin-top: 20px;
  text-align: center;
  font-size: 0.85rem;
  color: #94a3b8;
}

.hidden { display: none; }

.admin {
  background: gold;
  color: black;
  padding: 3px 6px;
  border-radius: 6px;
  font-size: 0.75rem;
  margin-left: 6px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginCard" class="card">
  <h2>Login (Roll Number)</h2>
  <input id="rollInput" placeholder="e.g. 2501ce01">
  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<h2>
  üèë Hockey Availability Dashboard
  <span id="adminTag" class="admin hidden">ADMIN</span>
</h2>

<div id="now"></div>

<div class="card">
  <h3>Player Personal Override</h3>

  <select id="playerSelect"></select>

  <select id="overrideDay">
    <option>Monday</option><option>Tuesday</option>
    <option>Wednesday</option><option>Thursday</option><option>Friday</option>
  </select>

  <input type="time" id="overrideStart">
  <input type="time" id="overrideEnd">

  <select id="overrideStatus">
    <option value="busy">Busy</option>
    <option value="free">Free</option>
  </select>

  <button onclick="addPersonalOverride()">Add / Replace Override</button>
</div>

<div class="card">
  <h3>Free Players Now</h3>
  <ul id="freePlayers"></ul>
</div>

<div class="card">
  <h3>Best Common Free Slot Today</h3>
  <div id="bestSlot"></div>
</div>

</div>

<footer>‚Äî RSR ‚Äî</footer>

<script>
/* ================= AUTH ================= */
const ADMIN_ROLL = "2501ce01";
let currentUserRoll = null;
let currentPlayer = null;

/* ================= TIMETABLE ================= */
const timetable = {
  G20: {
    Monday: [
      { start: "08:00", end: "08:55", status: "busy" },
      { start: "09:00", end: "09:55", status: "busy" },
      { start: "10:00", end: "10:55", status: "busy" },
      { start: "11:00", end: "11:55", status: "busy" },
      { start: "12:00", end: "12:55", status: "busy" },
      { start: "14:00", end: "14:55", status: "free" },
      { start: "15:00", end: "15:55", status: "busy" },
      { start: "16:00", end: "16:55", status: "busy" },
      { start: "17:00", end: "17:55", status: "free" },
      { start: "18:00", end: "18:55", status: "free" }
    ],
    Tuesday: [
      { start: "08:00", end: "08:55", status: "busy" },
      { start: "09:00", end: "09:55", status: "free" },
      { start: "10:00", end: "10:55", status: "free" },
      { start: "11:00", end: "11:55", status: "busy" },
      { start: "12:00", end: "12:55", status: "free" },
      { start: "14:00", end: "14:55", status: "busy" },
      { start: "15:00", end: "15:55", status: "busy" },
      { start: "16:00", end: "16:55", status: "busy" },
      { start: "17:00", end: "17:55", status: "busy" },
      { start: "18:00", end: "18:55", status: "free" },
      { start: "19:00", end: "19:55", status: "free" }
    ],
    Wednesday: [
      { start: "08:00", end: "08:55", status: "free" },
      { start: "09:00", end: "09:55", status: "free" },
      { start: "10:00", end: "10:55", status: "free" },
      { start: "11:00", end: "11:55", status: "free" },
      { start: "12:00", end: "12:55", status: "busy" },
      { start: "14:00", end: "14:55", status: "free" },
      { start: "15:00", end: "15:55", status: "busy" },
      { start: "16:00", end: "16:55", status: "busy" },
      { start: "17:00", end: "17:55", status: "free" },
      { start: "18:00", end: "18:55", status: "busy" }
    ],
    Thursday: [
      { start: "08:00", end: "08:55", status: "free" },
      { start: "09:00", end: "09:55", status: "free" },
      { start: "10:00", end: "10:55", status: "free" },
      { start: "11:00", end: "11:55", status: "busy" },
      { start: "12:00", end: "12:55", status: "free" },
      { start: "14:00", end: "14:55", status: "free" },
      { start: "15:00", end: "15:55", status: "busy" },
      { start: "16:00", end: "16:55", status: "busy" },
      { start: "17:00", end: "17:55", status: "free" },
      { start: "18:00", end: "18:55", status: "free" }
    ],
    Friday: [
      { start: "08:00", end: "08:55", status: "busy" },
      { start: "09:00", end: "09:55", status: "busy" },
      { start: "10:00", end: "10:55", status: "busy" },
      { start: "11:00", end: "11:55", status: "busy" },
      { start: "12:00", end: "12:55", status: "busy" },
      { start: "14:00", end: "14:55", status: "busy" },
      { start: "15:00", end: "15:55", status: "busy" },
      { start: "16:00", end: "16:55", status: "busy" },
      { start: "17:00", end: "17:55", status: "free" },
      { start: "18:00", end: "18:55", status: "busy" }
    ]
  }
};

/* ================= PLAYERS ================= */
let players = JSON.parse(localStorage.getItem("players")) || [
  
  { roll: "2501ce01", name: "Rachit", group: "G20", active: true, overrides: [] },
  { roll: "2501ce02", name: "Aman", group: "G20", active: true, overrides: [] }
  
];

function savePlayers() {
  localStorage.setItem("players", JSON.stringify(players));
}

/* ================= LOGIN ================= */
function login() {
  const roll = rollInput.value.trim().toLowerCase();
  if (!roll) return;

  currentUserRoll = roll;
  currentPlayer = players.find(p => p.roll === roll);

  if (!currentPlayer) {
    alert("Roll number not registered");
    return;
  }

  loginCard.classList.add("hidden");
  app.classList.remove("hidden");

  if (roll === ADMIN_ROLL) adminTag.classList.remove("hidden");

  populatePlayers();
  updateUI();
}

/* ================= TIME ================= */
function now() {
  const d = new Date();
  return {
    day: d.toLocaleDateString("en-US", { weekday: "long" }),
    time: d.toTimeString().slice(0,5)
  };
}

function inRange(t, s, e) { return t >= s && t <= e; }
function overlaps(a,b,c,d){ return !(b<=c || a>=d); }

/* ================= STATUS ================= */
function getTimetableStatus(group, day, time) {
  const slots = timetable[group]?.[day];
  if (!slots) return null;
  for (const s of slots) if (inRange(time,s.start,s.end)) return s.status;
  return null;
}

function getPlayerStatus(player, day, time) {
  for (let i = player.overrides.length-1; i>=0; i--) {
    const o = player.overrides[i];
    if (o.day===day && inRange(time,o.start,o.end)) return o.status;
  }
  const tt = getTimetableStatus(player.group, day, time);
  if (tt) return tt;
  if (inRange(time,"00:00","08:00") || inRange(time,"19:00","23:59")) return "free";
  return "busy";
}

/* ================= OVERRIDES ================= */
function populatePlayers() {
  const sel = playerSelect;
  sel.innerHTML = "";
  players.forEach((p,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.innerText=p.name;
    if (p.roll===currentUserRoll || currentUserRoll===ADMIN_ROLL)
      sel.appendChild(o);
  });
}

function addPersonalOverride() {
  const i = playerSelect.value;
  const p = players[i];
  if (p.roll!==currentUserRoll && currentUserRoll!==ADMIN_ROLL) return;

  const day = overrideDay.value;
  const start = overrideStart.value;
  const end = overrideEnd.value;
  const status = overrideStatus.value;

  if (!start || !end || start>=end) return alert("Invalid time");

  p.overrides = p.overrides.filter(o =>
    !(o.day===day && overlaps(start,end,o.start,o.end))
  );

  p.overrides.push({day,start,end,status});
  savePlayers();
  updateUI();
}

/* ================= UI ================= */
function updateUI() {
  const {day,time}=now();
  document.getElementById("now").innerText = `${day} ‚Ä¢ ${time}`;


  freePlayers.innerHTML="";
  players.filter(p=>p.active && getPlayerStatus(p,day,time)==="free")
    .forEach(p=>{
      const li=document.createElement("li");
      li.innerText=p.name;
      freePlayers.appendChild(li);
    });
  if(!freePlayers.innerHTML) freePlayers.innerHTML="<li>No one free</li>";

  const best=getBestSlotToday();
  bestSlot.innerHTML=`
    <b>${best.start} ‚Äì ${best.end}</b><br>
    Free players: ${best.count}<br>
    ${best.names.join(", ")||"No one"}
  `;
}

/* ================= BEST SLOT ================= */
function getMidTime(s,e){
  const a=s.split(":").map(Number), b=e.split(":").map(Number);
  const m=(a[0]*60+a[1]+b[0]*60+b[1])/2;
  return `${String(Math.floor(m/60)).padStart(2,"0")}:${String(m%60).padStart(2,"0")}`;
}
function getDaySlots(){
  return [
    {start:"08:00",end:"08:55"},{start:"09:00",end:"09:55"},
    {start:"10:00",end:"10:55"},{start:"11:00",end:"11:55"},
    {start:"12:00",end:"12:55"},{start:"14:00",end:"14:55"},
    {start:"15:00",end:"15:55"},{start:"16:00",end:"16:55"},
    {start:"17:00",end:"17:55"},{start:"18:00",end:"18:55"}
  ];
}
function getBestSlotToday(){
  const {day}=now();
  let best={count:-1};
  getDaySlots().forEach(s=>{
    const t=getMidTime(s.start,s.end);
    const free=players.filter(p=>p.active && getPlayerStatus(p,day,t)==="free");
    if(free.length>best.count)
      best={...s,count:free.length,names:free.map(p=>p.name)};
  });
  return best;
}

/* ================= INIT ================= */
setInterval(updateUI,60000);
</script>

</body>
</html>
